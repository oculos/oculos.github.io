<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <title>Homebridge, Nexa switches and Udoo Neo</title>
  <meta name="description" content="The year is ending and I would like to finish it with a cool project.

">
  <meta name="author" content="Francis Augusto Medeiros-Logeay">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Homebridge, Nexa switches and Udoo Neo">
  <meta name="twitter:description" content="The year is ending and I would like to finish it with a cool project.

">
  
  <meta name="twitter:creator" content="francisaugusto">
  
  <meta name="twitter:image" content="/images/favicons/favicon-194x194.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Homebridge, Nexa switches and Udoo Neo">
  <meta property="og:description" content="The year is ending and I would like to finish it with a cool project.

">
  <meta property="og:image" content="/images/favicons/favicon-194x194.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <link rel="stylesheet" href="/css/main.css?1514667871179765000">
  <link rel="canonical" href="http://francisaugusto.com/2017/Homebrige-nexa-and-Udoo/">
  <link rel="alternate" type="application/rss+xml" title="Francis Augusto Medeiros-Logeay" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Francis Augusto Medeiros-Logeay">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Francis Augusto Medeiros-Logeay</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">Developer, IT-Law expert, runner</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
				
              <li class="navigation__item"><a href="/about.html" title="About me" class="blog-button">About</a></li>
            </ul>
          </nav>


          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
				
              <li class="navigation__item"><a href="/#blog" title="link to Francis Augusto Medeiros-Logeay blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>
		  
		  
		  

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/francisaugusto" title="@francisaugusto on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            
              <!-- Facebook -->
              <li class="navigation__item">
                <a href="http://fb.me/francisaugusto" title="francisaugusto on Facebook" target="_blank">
                  <i class="icon icon-social-facebook"></i>
                  <span class="label">Facebook</span>
                </a>
              </li>
            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/francismedeiros" title="francismedeiros on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/oculos" title="oculos on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="/contact-form" title="Contact" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="29 Dec 2017" class="post-meta__date date">29 Dec 2017</time>
      
      &#8226; <span class="post-meta__tags">on <a href="/tags/#projects">projects</a> <a href="/tags/#homebridge">homebridge</a> </span>
      
    </div>
    <h1 class="post-title">Homebridge, Nexa switches and Udoo Neo</h1>
  </header>

  <section class="post">
    <p>The year is ending and I would like to finish it with a cool project.</p>

<p>I am a sucker for gadgets, especially small cheap computers like the <a href="https://www.raspberrypi.org">Raspberry Pi</a>. Some years ago, I contributed to a <a href="https://Kickstarter.com">Kickstarter</a> project called <a href="https://www.udoo.org/get-started-neo/">Udoo Neo</a>, which is a credit-sized computer + Arduino. It also came with some sensors for measuring the temperature and barometric pressure. I used it as a tool to monitor the temperature on our living room and to run some experiments.</p>

<p>I have lots of <a href="https://arduino.cc">Arduino boards</a> that I used on other projects, such as an automatic system to water my plants. I wanted to experiment with 433mhz transmitters, mostly because they are cheap and I wanted to use them to study basic network concepts.</p>

<p>On my flat we have some lights on our living room that are plugged to outlets and controlled via remote control. I use a cheap <a href="https://nexa.se">Nexa</a> PE-3 kit. <a href="https://www.clasohlson.com/no/Nexa-PE-3-3-pack-fjernstrømbrytere/36-4602">This</a> is the exact model.</p>

<p>I realized that those Nexa outlets use the 433mhz frequency, so I kept thinking about controlling the lights plugged into them with an Arduino at some point, but didn’t have a reason for that (other than the gimmick aspect of it). That changed when I came across <a href="https://medium.com/arvin-singla/apple-homekit-hacking-3d2902e7a1df">this post</a>, where the author describes how he used <a href="https://github.com/nfarina/homebridge">Homebridge</a> to control his remote lights. But what is Homebridge?</p>

<p>Well, if you are an Apple-fanboy like me, you know that Apple has a technology called HomeKit that allows you to control devices on your home from your iPhone, iPad or Apple TV. But there are not so many devices available for HomeKit yet, and those that are available  are expensive. Enter Homebridge, an open source project that allows you to create your own accessories for HomeKit. You see where I am going: if I can control my outlets with Arduino, maybe I could connect that with Homebridge and ta-daaa, I would be able to switch my lights on and off (as well as I could see my room’s temperature on my phone using a temperature sensor connected to the Udoo).</p>

<p>As I said, I had an Udoo laying around, and lots of cheap 433 receivers and transmitters. So my goal was:</p>

<ul>
  <li>to control my light switches with my Udoo Neo;</li>
  <li>to install Homebridge on the Udoo Neo;</li>
  <li>to be able to control my lights switches via my iPhone.</li>
</ul>

<h3 id="controlling-my-light-switches-with-udoo-neo">Controlling my light switches with Udoo Neo</h3>

<p>There are many cool projects for the Arduino that allow you to record the commands you send from a 433mhz remote control and to send those command backs. Before trying with my Udoo Neo, I tried first with my Arduino, and these sketches/products worked fine:</p>

<ul>
  <li><a href="http://fritzing.org/media/fritzing-repo/projects/n/nexardu-illumination-smart-control/code/">Sketches to learn and send back commands</a>, which is a modification of <a href="http://playground.arduino.cc/Code/HomeEasy">this</a>. I used <a href="http://fritzing.org/media/fritzing-repo/projects/n/nexardu-illumination-smart-control/code/Nexa_Ok_3_RX.ino">this sketch</a> to learn the codes of my remote control, and then I used <a href="https://github.com/calle-gunnarsson/NexaCtrl">NexaCtrl</a> to actually send the commands.</li>
  <li><a href="https://433mhz.codeplex.com/SourceControl/latest#rc-switch-fork/RCTransmitter.cpp">rc-switch-fork</a> worked great as well. The original <a href="https://github.com/sui77/rc-switch/wiki">rc-switch</a> didn’t work.</li>
</ul>

<p>The problem is that <em>none of those worked on my Udoo Neo</em>. You see, the Arduino on the Udoo Neo is not based on the AVR architecture of the “common” arduinos. Therefore, the solutions above didn’t work with my Udoo Neo. I suspect the libraries used by those packages rely on stuff available only to Arduinos based on AVR. I could simply connect an Arduino to the Udoo Neo and get this done, but I thought it would be a waste of resources.</p>

<p>I then decided to give <a href="http://arduinobasics.blogspot.no/2014/06/433-mhz-rf-module-with-arduino-tutorial.html">this great tutorial</a> a try. I have bookmarked it a while ago because it is not a tutorial for a ready-made solution - well, it offers that as well - but remember when I said I wanted to study some basic network concepts? This tutorial teaches how to recognize basic signals typically used for this kind of communication between devices and I always thought I could try to replicate what he did one day. Well, this day has come.</p>

<p>What I did was that I used the <a href="http://arduinobasics.blogspot.no/2014/07/433-mhz-rf-module-with-arduino-tutorial_30.html">code he made to learn commands from a remote control</a>, then I printed the array of each command for my remote control on Arduino’s serial monitor, and created another sketch where I hard coded the commands by pasting the array so that I could send these codes. Not super elegant, but it works.</p>

<p>Since using the Arduino interface on the Udoo Neo is irritating (I access it via VNC), I decided to read the commands on an Arduino connected to my Mac, and transfer a sketch with the codes to the Udoo Neo. That sketch would read the serial interface, and when it receives a certain instruction from the Linux side of the Udoo Neo, it would then send the right code to turn a specific light on or off. The same scenario as if one were using a Raspberry Pi connected to an Arduino. It is also possible to send those signals using a Raspberry Pi, without an Arduino. I might try that at some point.</p>

<p>It worked! It wasn’t as reliable as on the Arduino connected to my Mac - I have to power off the transmitter every time I am not using it, but it worked.</p>

<p>Then I created a python script to send the commands via serial to the built-in Arduino of the Udoo Neo. Something like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&gt; python lightcontrol.py 1 off # turn the light 1 off
Light 1 is off
</code></pre>
</div>

<p>After that was done, it was time to install Homebridge.</p>

<h3 id="installing-homebridge-on-the-udoo-neo">Installing Homebridge on the Udoo Neo</h3>

<p>I did it following <a href="https://github.com/nfarina/homebridge/wiki/Running-HomeBridge-on-a-Raspberry-Pi">this tutorial here</a>. One note: make sure you are installing the absolutely latest version of NodeJS.</p>

<p>I wasn’t familiar with <code class="highlighter-rouge">npm</code>, so I found strange that on the docs of the project or on <a href="http://blog.theodo.fr/2017/08/make-siri-perfect-home-companion-devices-not-supported-apple-homekit/">this excellent guide on how to write a Homebridge plugin</a> it was always suggested to publish plugins to a plugin repository. I didn’t do it. I simply created a local plugin by creating a directory on <code class="highlighter-rouge">/usr/lib/node_modules</code>, and then I created the proper <code class="highlighter-rouge">index.js</code> and <code class="highlighter-rouge">package.json</code>. I don’t see a reason to make my plugin public, as I imagine that my solution is very tied to the system I am using. Of course, if anyone feels he might benefit from it, just drop me a note. Remember:</p>

<ul>
  <li>Your plugin must start with <code class="highlighter-rouge">homebridge</code>, for example, <code class="highlighter-rouge">homebridge-myplugin</code></li>
  <li>Do not follow the code he shows on the tutorial, but rather <a href="https://github.com/fredericbarthelet/homebridge-smappee/blob/master/index.js">the code he actually wrote for his project</a>. I found it more up to date.</li>
</ul>

<p>The result is that now I can control all the lights on my room with my iPhone/Apple watch, even with Siri, with very cheap equipment I already had!</p>

<p>This is how it looks:</p>

<p><img src="http://francisaugusto.com/assets/homebridge.png" alt="This is how it looks" /></p>

<p>My <code class="highlighter-rouge">index.js</code> file looks like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Service</span><span class="p">,</span> <span class="nx">Characteristic</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">homebridge</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Service</span> <span class="o">=</span> <span class="nx">homebridge</span><span class="p">.</span><span class="nx">hap</span><span class="p">.</span><span class="nx">Service</span><span class="p">;</span>
    <span class="nx">Characteristic</span> <span class="o">=</span> <span class="nx">homebridge</span><span class="p">.</span><span class="nx">hap</span><span class="p">.</span><span class="nx">Characteristic</span><span class="p">;</span>
          <span class="nx">homebridge</span><span class="p">.</span><span class="nx">registerAccessory</span><span class="p">(</span><span class="s2">"homebridge-lightcontroller"</span><span class="p">,</span> <span class="s2">"LightController"</span><span class="p">,</span> <span class="nx">myLightController</span><span class="p">);</span>
    <span class="nx">homebridge</span><span class="p">.</span><span class="nx">registerAccessory</span><span class="p">(</span><span class="s2">"homebridge-lightcontroller"</span><span class="p">,</span><span class="s2">"Temperature"</span><span class="p">,</span><span class="nx">myTemperature</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">myTemperature</span><span class="p">(</span><span class="nx">log</span><span class="p">,</span><span class="nx">config</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="nx">log</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceAccessory</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">.</span><span class="nx">AccessoryInformation</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceAccessory</span>
        <span class="p">.</span><span class="nx">setCharacteristic</span><span class="p">(</span><span class="nx">Characteristic</span><span class="p">.</span><span class="nx">Manufacturer</span><span class="p">,</span> <span class="s2">"Francis"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceTemp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">.</span><span class="nx">TemperatureSensor</span><span class="p">(</span><span class="s2">"Living room temperature"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceTemp</span>
        <span class="p">.</span><span class="nx">getCharacteristic</span><span class="p">(</span><span class="nx">Characteristic</span><span class="p">.</span><span class="nx">CurrentTemperature</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'get'</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">getTemp</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">}</span>

<span class="nx">myTemperature</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getServices</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">serviceAccessory</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">serviceTemp</span><span class="p">];</span>
<span class="p">}</span>

<span class="nx">myTemperature</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getTemp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">'/sys/class/i2c-dev/i2c-1/device/1-0048/temp1_input'</span><span class="p">,</span> <span class="s1">'utf8'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
                    <span class="k">return</span>
                <span class="p">}</span>
    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">myLightController</span><span class="p">(</span><span class="nx">log</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="nx">log</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">command</span> <span class="o">=</span> <span class="nx">config</span><span class="p">[</span><span class="s1">'command'</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">acc</span> <span class="o">=</span> <span class="nx">config</span><span class="p">[</span><span class="s1">'acc'</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceAccessory</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">.</span><span class="nx">AccessoryInformation</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceAccessory</span>
        <span class="p">.</span><span class="nx">setCharacteristic</span><span class="p">(</span><span class="nx">Characteristic</span><span class="p">.</span><span class="nx">Manufacturer</span><span class="p">,</span> <span class="s2">"Francis"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceSwitch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">.</span><span class="nx">Switch</span><span class="p">(</span><span class="s2">"My Light Controller"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceSwitch</span>
        <span class="p">.</span><span class="nx">getCharacteristic</span><span class="p">(</span><span class="nx">Characteristic</span><span class="p">.</span><span class="nx">On</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'set'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">setPowerState</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">}</span>

<span class="nx">myLightController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getServices</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">serviceAccessory</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">serviceSwitch</span><span class="p">];</span>
<span class="p">}</span>

<span class="nx">myLightController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setPowerState</span> <span class="o">=</span>  <span class="kd">function</span> <span class="p">(</span><span class="nx">on</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">onOff</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">on</span><span class="p">){</span>
        <span class="nx">onOff</span> <span class="o">=</span> <span class="s2">"on"</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">onOff</span> <span class="o">=</span> <span class="s2">"off"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">comm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">command</span><span class="o">+</span><span class="s2">" "</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">acc</span><span class="o">+</span><span class="s2">" "</span><span class="o">+</span><span class="nx">onOff</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceAccessory</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">.</span><span class="nx">AccessoryInformation</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceAccessory</span>
        <span class="p">.</span><span class="nx">setCharacteristic</span><span class="p">(</span><span class="nx">Characteristic</span><span class="p">.</span><span class="nx">Manufacturer</span><span class="p">,</span> <span class="s2">"Francis"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceSwitch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">.</span><span class="nx">Switch</span><span class="p">(</span><span class="s2">"My Light Controller"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceSwitch</span>
        <span class="p">.</span><span class="nx">getCharacteristic</span><span class="p">(</span><span class="nx">Characteristic</span><span class="p">.</span><span class="nx">On</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'set'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">setPowerState</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">}</span>

<span class="nx">myLightController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getServices</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
       <span class="k">return</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">serviceAccessory</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">serviceSwitch</span><span class="p">];</span>
<span class="p">}</span>

<span class="nx">myLightController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setPowerState</span> <span class="o">=</span>  <span class="kd">function</span> <span class="p">(</span><span class="nx">on</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">onOff</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">on</span><span class="p">){</span>
       <span class="nx">onOff</span> <span class="o">=</span> <span class="s2">"on"</span><span class="p">;</span>
   <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
       <span class="nx">onOff</span> <span class="o">=</span> <span class="s2">"off"</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="nx">comm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">command</span><span class="o">+</span><span class="s2">" "</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">acc</span><span class="o">+</span><span class="s2">" "</span><span class="o">+</span><span class="nx">onOff</span><span class="p">;</span>
   <span class="kr">const</span> <span class="p">{</span> <span class="nx">exec</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'child_process'</span><span class="p">);</span>
   <span class="nx">exec</span><span class="p">(</span><span class="nx">comm</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
       <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                 <span class="c1">// node couldn't execute the command</span>
                 <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
   <span class="p">});</span>
   <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
 <span class="p">}</span></code></pre></figure>

<p>The only caveat with this system is that if I turn the light off using the remote control, the state of the lamp on the Home app will not reflect the actual state. This is the only limitation, and it can be a problem if you are considering some form for automation, as the system might skip turning something on as the state is already on.</p>

  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://francisaugusto.com/2017/Homebrige-nexa-and-Udoo/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/2017/Homebrige-nexa-and-Udoo'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//francisaugusto-com.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
       })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2017 Francis Augusto Medeiros-Logeay. All rights reserved.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1514667871179765000"></script>


    </div>

  </body>
</html>
